version: "3.9"
services:
  shell:
    build:
      context: ci
      dockerfile: Dockerfile.parcoach
      # NOTE: values for these args are automatically generated by the
      # build-image script in the CI;
      # FIXME: we should add an option to build-image for just printing
      # this part of the docker compose file.
      args:
        - UBUNTU_VERSION=focal
        - CMAKE_VERSION=3.25.2
        - CMAKE_SHA256=783da74f132fd1fea91b8236d267efa4df5b91c5eec1dea0a87f0cf233748d99
        - LLVM_VERSION=15
        - OPENMPI_VERSION=deb
      tags:
        - "registry.gitlab.inria.fr/parcoach/parcoach:ubuntu-focal-build-20230209-llvm-15-openmpi-deb"
    # NOTE: I don't think this is possible, but ideally we would share this
    # variable with the .gitlab-ci.yml
    image: "registry.gitlab.inria.fr/parcoach/parcoach:ubuntu-focal-build-20230209-llvm-15-openmpi-deb"
    volumes:
      - .:/home/parcoach/sources
  shell-mpich:
    build:
      context: ci
      dockerfile: Dockerfile.parcoach
      args:
        - UBUNTU_VERSION=focal
        - CMAKE_VERSION=3.25.2
        - CMAKE_SHA256=783da74f132fd1fea91b8236d267efa4df5b91c5eec1dea0a87f0cf233748d99
        - LLVM_VERSION=15
        - MPICH_VERSION=deb
      tags:
        - "registry.gitlab.inria.fr/parcoach/parcoach:ubuntu-focal-build-20230209-llvm-15-mpich-deb"
    # NOTE: I don't think this is possible, but ideally we would share this
    # variable with the .gitlab-ci.yml
    image: "registry.gitlab.inria.fr/parcoach/parcoach:ubuntu-focal-build-20230209-llvm-15-mpich-deb"
    volumes:
      - .:/home/parcoach/sources
  ubi:
    build:
      context: ci
      dockerfile: Dockerfile.rhel
      args:
        - UBI_VERSION=8.6
        - MPI_VERSION=4.1.4
        - MPI_SHA256=e166dbe876e13a50c2882e11193fecbc4362e89e6e7b6deeb69bf095c0f4fc4c
        - NINJA_VERSION=1.11.1
        - NINJA_SHA256=b901ba96e486dce377f9a070ed4ef3f79deb45f4ffe2938f8e7ddc69cfb3df77
        - LLVM_VERSION=15.0.7
        - TESTS_VERSION=20221130
        - CMAKE_VERSION=3.25.2
        - CMAKE_SHA256=783da74f132fd1fea91b8236d267efa4df5b91c5eec1dea0a87f0cf233748d99
      tags:
        - "registry.gitlab.inria.fr/parcoach/parcoach:ubi-8.6-build-20230213-ninja-1.11.1-mpi-4.1.4-llvm-15.0.7-tests-20221130"
    image: "registry.gitlab.inria.fr/parcoach/parcoach:ubi-8.6-build-20230213-ninja-1.11.1-mpi-4.1.4-llvm-15.0.7-tests-20221130"
    volumes:
      - .:/home/parcoach/sources
